    // Переключение темы
    function toggleTheme() {
        document.body.classList.toggle('dark');
        localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
        updateChapterModalTheme();
    }

    // Проверка сохранённой темы при загрузке
    document.addEventListener('DOMContentLoaded', function() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark' || savedTheme === null) {
            document.body.classList.add('dark');
        } else {
            document.body.classList.add('light');
        }
    });

    // Функция для фильтрации по тегам, автору, году
    function filterBy(type, value) {
        const params = new URLSearchParams();
        params.set(type, value);
        window.location.href = `../bookreader_catalog.html?${params.toString()}`;
    }

    // Обновление темы модального окна
    function updateChapterModalTheme() {
        const modal = document.querySelector('.chapter-modal');
        if (modal) {
            if (document.body.classList.contains('dark')) {
                modal.classList.remove('light');
            } else {
                modal.classList.add('light');
            }
        }
    }

    // Функция для открытия главы
    function readChapter(chapterId) {
        // Создаём модальное окно
        const modal = document.createElement('div');
        modal.className = 'chapter-modal';
        
        // Устанавливаем тему в соответствии с основной темой
        if (!document.body.classList.contains('dark')) {
            modal.classList.add('light');
        }
        
        // Заголовок и текст главы
        let chapterTitle = '';
        let chapterText = '';
        
        switch(chapterId) {
            case 'chapter1':
                chapterTitle = 'Глава 3: Вечеринка в Меритоне';
                chapterText = `
                    <p>На следующий день мисс Беннет и её сестры отправились на бал в Меритон, и все с нетерпением ожидали встречи с новым богатым и привлекательным молодым человеком, мистером Бингли. Когда он вошёл в комнату, он сразу привлёк к себе внимание, его манеры были непринуждёнными, а лицо — приятным. Он быстро стал центром внимания среди дам.
Мистер Бингли был настолько заинтересован Джейн, что сразу попросил её танцевать. В это время его друг, мистер Дарси, стоял в стороне и наблюдал за всем происходящим. Он был полон сдержанности и не выражал никаких эмоций. Несмотря на это, его взгляд был направлен на Джейн с некоторым интересом, хотя он не стал проявлять своё мнение публично.
Когда они начали танцевать, мистер Бингли продолжал восхищаться Джейн. Он говорил ей, как она прекрасно танцует, а её красота заставляла его забывать обо всем остальном. В своей речи он не скрывал своего восхищения её внешностью, что не могло не вызвать зависть у других дам.
Сами же сестры Беннет наблюдали за происходящим с восторгом. Для них это был знак того, что Джейн может найти себе достойного мужа. Однако сама Джейн не могла не заметить холодное поведение мистера Дарси. Его взгляд был немного пренебрежительным, и это привело её в замешательство. Когда танец завершился, мистер Дарси всё также оставался в тени, предпочитая наблюдать за происходящим без какого-либо участия.
После танца мистер Бингли и его сестры пригласили Беннетов на ужин, и Джейн, получив приглашение, была счастливой. Это предвестие того, что ей удастся продолжить знакомство с мистером Бингли, значительно укрепляло её уверенность. Однако, между тем, её младшая сестра, Лиззи, продолжала наблюдать за всем происходящим с осторожностью и недоверием к мистеру Дарси.</p>
                `;
                break;
            case 'chapter13':
                chapterTitle = 'Глава 34: Признание мистера Дарси';
                chapterText = `
                    <p>Мистер Дарси и Элизабет обменивались взглядами в течение нескольких месяцев, но их отношения оставались достаточно холодными. Элизабет не могла забыть тех неприятных слов, которые мистер Дарси сказал о её семье, и её отношение к нему оставалось резко отрицательным. Несмотря на это, он продолжал проводить с ней время, и это приводило её в замешательство.
Однажды вечером, когда они оказались наедине, мистер Дарси внезапно произнёс, что имеет нечто важное для неё. Элизабет была насторожена, но не ожидала такого поворота событий. Мистер Дарси взял её руку и, по всей видимости, стараясь собрать свои мысли, произнёс:
«Элизабета, несмотря на мои чувства и переживания, я вынужден признаться вам в том, что полюбил вас с первого момента, как увидел. Я прекрасно осознаю, что наш статус и разница в социальном положении делают наш союз невозможным, и все же...»
Он говорил, как его чувства противоречили его воле и разуму, как много он думал о том, чтобы победить свои собственные предрассудки. Он продолжал объяснять, как полюбил её за её ум, за её остроумие, и как он был готов отказаться от всех своих благ в пользу её счастья. Однако, несмотря на красивые слова, он не мог скрыть высокомерие в своём голосе, и Элизабет почувствовала это.
Ответ Элизабеты был резким. Она сказала ему, что она не может принять его любовь, так как его поведение, отношение к её семье и его собственное высокомерие были для неё неприемлемыми. Она напомнила ему, что он сделал много предосудительных поступков, включая отказ помочь её сестре Лидии и вмешательство в отношения с мистером Уикемом. Этот монолог оставил мистера Дарси в полном недоумении.
После этого он ушёл, оставив Элизабету задумываться о произошедшем. Она ощущала облегчение, что смогла выразить свои чувства и не поддаться на его признание.</p>
                `;
                break;
            case 'chapter32':
                chapterTitle = 'Глава 58: Согласие Элизабет';
                chapterText = `
                    <p>После многих недель размышлений и перемен в чувствах, Элизабета начала осознавать, что её отношение к мистеру Дарси изменилось. Она узнала о его реальных поступках, которые привели её к решению, что её первоначальная оценка была ошибочной. Он не был таким, каким она его считала. Он действовал по-своему, и её предвзятость мешала ей понять его истинные намерения.
И вот, однажды они снова встретились в Пемберли. Мистер Дарси подошёл к ней, и его глаза, полные волнения, встретились с её.
«Элизабета, я долго думал о том, что вы сказали. Теперь я понимаю, что мой отказ помочь вашей сестре Лидии был ошибкой. Я искренне сожалею об этом».
Её сердце отозвалось на его слова, и она поняла, что готова простить его. С этим пониманием она взглянула на него и сказала:
«Мистер Дарси, я понимаю, что многие вещи изменились, и мои чувства тоже».
Он наклонился и предложил ей свою руку, и на этот раз её ответ был не таким резким. Она сказала:
«Я готова быть с вами, если вы так хотите, мистер Дарси».
Их встреча завершилась долгожданным признанием. В этот момент, после всех недоразумений и ошибок, они нашли друг друга.</p>
                `;
                break;
        }
        
        // Добавляем содержимое модального окна
        modal.innerHTML = `
            <div class="chapter-content">
                <h2>${chapterTitle}</h2>
                <div class="chapter-text">
                    ${chapterText}
                </div>
                <button class="close-chapter">
                    Закрыть
                </button>
            </div>
        `;
        
        document.body.appendChild(modal);
        document.body.style.overflow = 'hidden';
        
        // Обработчик закрытия
        modal.querySelector('.close-chapter').addEventListener('click', function() {
            modal.remove();
            document.body.style.overflow = '';
        });
        
        // Закрытие по клику вне контента
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        });
    }
