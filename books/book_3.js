    // Переключение темы
    function toggleTheme() {
        document.body.classList.toggle('dark');
        localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
        updateChapterModalTheme();
    }

    // Проверка сохранённой темы при загрузке
    document.addEventListener('DOMContentLoaded', function() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark' || savedTheme === null) {
            document.body.classList.add('dark');
        } else {
            document.body.classList.add('light');
        }
    });

    // Функция для фильтрации по тегам, автору, году
    function filterBy(type, value) {
        const params = new URLSearchParams();
        params.set(type, value);
        window.location.href = `../bookreader_catalog.html?${params.toString()}`;
    }

    // Обновление темы модального окна
    function updateChapterModalTheme() {
        const modal = document.querySelector('.chapter-modal');
        if (modal) {
            if (document.body.classList.contains('dark')) {
                modal.classList.remove('light');
            } else {
                modal.classList.add('light');
            }
        }
    }

    // Функция для открытия главы
    function readChapter(chapterId) {
        // Создаём модальное окно
        const modal = document.createElement('div');
        modal.className = 'chapter-modal';
        
        // Устанавливаем тему в соответствии с основной темой
        if (!document.body.classList.contains('dark')) {
            modal.classList.add('light');
        }
        
        // Заголовок и текст главы
        let chapterTitle = '';
        let chapterText = '';
        
        switch(chapterId) {
            case 'chapter1':
                chapterTitle = 'Глава 7: Комната без времени';
                chapterText = `
                    <p>Комната пахла пылью, старым деревом и чем-то сладким, едва уловимым — возможно, это был запах воспоминаний. Она находилась за второй дверью лавки мистера Чаррингтона — и, по утверждению самого лавочника, никто сюда не заходил десятилетиями. Винстон провёл пальцем по подоконнику, оставляя на нём чёткую линию. Окно было плотно закрыто, но не заколочено, и за мутным стеклом он мог различить тени города. Там, внизу, шёл дождь — серый, вязкий, как мазут, он стекал по камням Победоносной площади.
Здесь не было телеэкрана. Эта деталь одновременно тревожила и манила. Винстон чувствовал себя так, будто вошёл в святыню, в пространство, где время остановилось. Джулия села на обитый цветочной тканью диван и сняла сапоги. Она выглядела иначе, почти мирно. Казалось, стены комнаты поглощали тревогу, гнев, весь тот непрерывный внутренний гул, что сопровождал их за пределами.
— Представь, — сказала она, закусив губу, — что мы могли бы жить здесь. Просто жить. Не сражаться, не скрываться, не притворяться. Готовить еду, спать, читать книги.
Винстон кивнул. Идея была утопична, но в этой комнате с облупившимися обоями она казалась достижимой. Он подошёл к старинной этажерке и взял в руки стеклянную безделушку — тяжёлый предмет с кораллом внутри. Его завораживала форма, бесполезность и, самое главное, беспамятство — вещь, которой не касался Большой Брат. Это был символ прошлого, в котором существовала красота ради самой себя.
— Они не могут стереть всё, — прошептал он. — Есть вещи, которые не поддаются переписыванию.
— Но они стараются, — усмехнулась Джулия. — Даже язык уже не наш.
Тут в углу заскрипела половица. Винстон резко обернулся. Ничего. Только кресло, зеркало и тишина. Он сжал кулаки — воображение часто играло с ним в такие игры. Возможно, именно поэтому Партия и позволяла существовать таким комнатам — чтобы напоминать: даже свобода может быть клеткой.
На стене висели старые часы — с двенадцатичасовым циферблатом, каким они были до Революции. Стрелки тикали медленно, противно громко. Казалось, каждый удар — это не просто секунда, а вызов самому принципу Двойноймысли: время может идти только вперёд, и оно всегда принадлежит Партии. В этой комнате время текло само по себе, и это было самым опасным.
— Мы не должны сюда возвращаться, — наконец сказал Винстон. — Это ловушка. Даже если пока её не видно.
Джулия посмотрела на него. В её взгляде не было ни страха, ни отчаяния — только упрямая решимость.
— А если это всё, что у нас есть?
Они молчали. За окном город жил своей ложной жизнью, а в этой комнате рождалась правда, за которую приходилось платить слишком высокую цену.</p>
                `;
                break;
            case 'chapter13':
                chapterTitle = 'Глава 14: Прах памяти';
                chapterText = `
                    <p>Пыль. Всё вокруг — столы, пол, воздух — было наполнено мелкой, почти невесомой пылью. Она казалась символом всего прошлого, стертого, перемолотого в архивных муках Министерства Правды. Винстон стоял перед пневмолюком, сжимая тонкую полоску бумаги, на которой значились три фамилии. Он знал: эти люди были настоящими. Он видел их на старой фотографии, которую ему удалось тайком просмотреть в промежутке между сменами. Она исчезла почти сразу же, как будто сама Партия почувствовала, что фотография нарушает причинно-следственную связь.
Фамилии были знакомы каждому в Океании. Джонс, Ааронсон и Рутерфорд. Герои революции, предатели Партии, уничтоженные и… оправданные памятью Винстона. Он всё чаще ловил себя на мысли, что память — это преступление. Не чувствовать — вот что безопасно. Не помнить — вот что правильно.
Он медленно опустил бумагу в пневмолюк и нажал рычаг. Бумага исчезла в клубах горячего воздуха. История переписана. Он остался жив. Пока.
Позже, в кафетерии, он пил чёрную горькую жидкость, которую называли кофе. Он смотрел, как Партия делает из людей не мыслящих существ, а отражения самих лозунгов: «Свобода — это рабство», «Незнание — сила». Слова, которые вдалбливались в череп, пока оттуда не выпадали собственные мысли. Он видел, как мужчина за соседним столом улыбается, глядя в пустоту. Возможно, его только что простили. Возможно, его скоро казнят. Иногда между этими событиями не было никакой разницы.
Винстон знал: он один из последних. Один из тех, кто чувствует. Один из тех, кто помнит. Один из тех, кто будет разрушен.</p>
                `;
                break;
            case 'chapter32':
                chapterTitle = 'Глава 21: Уроки боли';
                chapterText = `
                    <p>Когда дверь камеры захлопнулась за ним, Винстон понял, что началось настоящее испытание. До этого были лишь преддверия — страх, подозрения, слежка. Здесь же начиналась суть. Комната 101.
В ней не было ничего — кроме стола, кресла и серого лица О'Брайена, в котором угадывалось нечто почти отеческое. Оно было лицом учителя, решившего показать ученику ошибки, но при этом не потерявшего ни капли хладнокровной уверенности в собственной правоте.
— Ты думаешь, что реальность — это то, что ты чувствуешь, — сказал О'Брайен. — Но это не так. Реальность — то, что говорит Партия. Если Партия говорит, что ты видишь пять пальцев, а ты видишь четыре — ты либо сумасшедший, либо враг.
Винстон молчал. Его пальцы были сведены в тиски. Каждый раз, когда он пытался ответить, напряжение усиливалось. Он думал, что боль — это предел. Но предел оказался дальше.
— Кто управляет прошлым — управляет будущим. Кто управляет настоящим — управляет прошлым, — повторил О'Брайен, словно мантру.
— Но ведь… дважды два — четыре, — прошептал Винстон.
— Иногда, — спокойно ответил тот. — Иногда — пять. Или три. Или всё сразу. Нужно лишь верить.
Ток прошёл по его телу, вырывая крик. Он хотел сопротивляться, кричать, спорить — но в какой-то момент понял: истина растворяется в боли. Логика ломается. Даже вера умирает. Остаётся только Партия.
Когда он вышел из комнаты, он уже не был тем же. Он не думал, он не спорил, он не чувствовал. Где-то внутри остался крошечный уголок сознания, где жила Джулия, но даже её лицо уже расплывалось, будто было сном.
Теперь он знал: любовь — это ненависть, мысль — это преступление, свобода — это ложь.
И он любил Большого Брата.</p>
                `;
                break;
        }
        
        // Добавляем содержимое модального окна
        modal.innerHTML = `
            <div class="chapter-content">
                <h2>${chapterTitle}</h2>
                <div class="chapter-text">
                    ${chapterText}
                </div>
                <button class="close-chapter">
                    Закрыть
                </button>
            </div>
        `;
        
        document.body.appendChild(modal);
        document.body.style.overflow = 'hidden';
        
        // Обработчик закрытия
        modal.querySelector('.close-chapter').addEventListener('click', function() {
            modal.remove();
            document.body.style.overflow = '';
        });
        
        // Закрытие по клику вне контента
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        });
    }
